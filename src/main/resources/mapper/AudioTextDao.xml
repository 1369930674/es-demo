<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.hexin.dao.AudioTextDao">

    <select id="selectText" resultType="com.hexin.entity.AudioInfo">
        SELECT tat.file_id                                       as fileId,
               tat.asr_result                                    as asrResult,
--                tat.abstracts                                     as abstracts,
--                tat.keywords                                      as keywords,
               DATE_FORMAT(tat.update_time, '%Y-%m-%d %H:%i:%s') as updateTime,
               taf.user_id                                       as userId,
               taf.file_name                                     as fileName,
               DATE_FORMAT(taf.create_time, '%Y-%m-%d %H:%i:%s') as createTime
        from ${tableName} tat
                 left join t_audio_file_1 taf on taf.file_id = tat.file_id
        WHERE tat.file_id = #{fileId}
    </select>

    <select id="selectTableNames" parameterType="java.util.Map" resultType="java.lang.String">
        SELECT TABLE_NAME
        FROM information_schema.TABLES
        WHERE TABLE_SCHEMA = #{dataBaseName}
          AND TABLE_NAME LIKE concat(#{tableName}, '%')
    </select>
    <select id="getAudioCreateTimeById" parameterType="java.lang.Integer" resultType="java.util.Map">
        SELECT file_id                           AS fileId,
               user_id                           AS userId,
               DATE_FORMAT(create_time, '%Y_%m') AS createTime,
               model_code                        as modelCode
        FROM t_audio_file_1
        WHERE file_id = #{id}
    </select>

    <select id="getFileIds" resultType="java.lang.Integer" parameterType="com.hexin.entity.SyncParam">
        SELECT file_id
        FROM t_audio_file_1
        WHERE del_flag = 0
        <if test="startTime != null and startTime != ''">
            AND create_time &gt;= #{startTime}
        </if>
        <if test="endTime != null and endTime != ''">
            AND create_time &lt; #{endTime}
        </if>
        <if test="userId != null and userId != ''">
            AND user_id = #{userId}
        </if>
    </select>
    <select id="getFileInfo" resultType="com.hexin.entity.AudioInfo">
        SELECT file_id                                       as fileId,
               file_name                                     as fileName,
               user_id                                       as userId,
               DATE_FORMAT(create_time, '%Y-%m-%d %H:%i:%s') as createTime
        FROM t_audio_file_1
        WHERE file_id = #{fileId}
    </select>
    <select id="selectTextBatch" resultType="com.hexin.entity.AudioInfo">
        SELECT taf.file_id as fileId,
        tat.asr_result as asrResult,
        -- tat.abstracts as abstracts,
        -- tat.keywords as keywords,
        DATE_FORMAT(tat.update_time, '%Y-%m-%d %H:%i:%s') as updateTime,
        taf.user_id as userId,
        taf.file_name as fileName,
        DATE_FORMAT(taf.create_time, '%Y-%m-%d %H:%i:%s') as createTime
        FROM t_audio_file_1 taf
        LEFT JOIN ${tableName} tat ON taf.file_id = tat.file_id
        WHERE taf.file_id in
        <foreach collection="fileIds" item="fileId" index="index" separator="," open="(" close=")">
            #{fileId}
        </foreach>
    </select>

</mapper>
